<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitoring Hafalan Santri</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/static/manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/static/service-worker.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>

    <style>
        :root {
            --color-primary-light: #f0f4f8;
            --color-secondary-light: #ffffff;
            --color-text-light: #1f2937;
            --color-text-secondary-light: #6b7280;
            --color-accent-gold: #FFD700;
        }

        .dark {
            --color-primary-dark: #1a202c;
            --color-secondary-dark: #111827;
            --color-text-dark: #f3f4f6;
            --color-text-secondary-dark: #9ca3af;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            color: #e0e0e0;
            transition: background-color 0.5s ease;
        }

        .main-content {
            background-color: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.1);
        }

        .dark .main-content {
            background-color: rgba(17, 24, 32, 0.7);
        }

        /* Modern Panel Design */
        .modern-panel {
            background-color: #1a1a1a;
            border: 1px solid #333;
            box-shadow: 0 4px 60px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(20px);
            position: relative;
            overflow: hidden;
            border-radius: 1rem;
        }
        
        .modern-panel::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, rgba(255, 255, 255, 0) 0%, rgba(255, 215, 0, 0.5) 10%, rgba(255, 215, 0, 0) 20%);
            animation: rotate-border 6s linear infinite;
            z-index: -1;
        }

        @keyframes rotate-border {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        /* Futuristic Icons with Glowing Effect */
        .futuristic-icon-panel .icon-item {
            position: relative;
            color: #ccc;
            transition: all 0.3s ease;
        }

        .futuristic-icon-panel .icon-item:hover {
            color: var(--color-accent-gold);
            transform: scale(1.1);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8), 0 0 20px rgba(255, 215, 0, 0.6);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2d3748;
        }

        .dark ::-webkit-scrollbar-track {
            background: #334155;
        }

        ::-webkit-scrollbar-thumb {
            background: #64748b;
            border-radius: 4px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #94a3b8;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #4a5568;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Tooltip for features */
        .feature-tooltip .tooltip-text {
            visibility: hidden;
            width: 160px;
            background-color: #334155;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -80px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .feature-tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Video Modal */
        #welcome-modal {
            transition: opacity 0.3s ease;
        }

        /* Custom toggle switch for alarm */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #FFD700;
        }

        .toggle-checkbox:checked + .toggle-label {
            background-color: #FFD700;
        }
        
        /* Dark mode toggle switch */
        .dark-mode-toggle-label {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
            cursor: pointer;
        }

        .dark-mode-toggle-label input {
            display: none;
        }

        .dark-mode-toggle-label .slider {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4b5563;
            transition: .4s;
            border-radius: 24px;
        }

        .dark-mode-toggle-label .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #FFD700;
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .quiz-option {
            transition: all 0.2s ease-in-out;
        }
        .quiz-option.selected {
            border: 2px solid #FFD700;
            background-color: #3b3a2e;
            font-weight: 600;
        }
        .quiz-option.correct {
            background-color: #1a533c;
            border: 2px solid #10B981;
        }
        .quiz-option.incorrect {
            background-color: #631717;
            border: 2px solid #EF4444;
        }

        /* AI Chat styling */
        .chat-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 120px);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: #111827;
            /* Dark background */
            color: #f3f4f6;
        }

        .chat-messages {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            background-color: #1f2937;
            /* Slightly lighter dark background */
        }

        .message {
            max-width: 80%;
            padding: 0.75rem 1rem;
            border-radius: 1rem;
            font-size: 0.875rem;
        }

        .message.user {
            align-self: flex-end;
            background-color: #FFD700;
            color: #000;
            border-bottom-right-radius: 0.25rem;
        }

        .message.ai {
            align-self: flex-start;
            background-color: #4b5563; /* Gray for AI messages */
            color: #f3f4f6;
            border-bottom-left-radius: 0.25rem;
        }

        .chat-input {
            padding: 1rem;
            background-color: #1f2937;
            border-top: 1px solid #374151;
            display: flex;
            align-items: center;
        }
        
        .chat-input input {
            flex-grow: 1;
            padding: 0.75rem;
            border-radius: 9999px; /* Pill shape */
            border: 1px solid #4b5563;
            background-color: #374151;
            color: #f3f4f6;
        }

        .chat-input button {
            padding: 0.75rem 1rem;
            background-color: #FFD700;
            color: black;
            border-radius: 9999px;
            margin-left: 0.5rem;
            cursor: pointer;
        }

        .ai-loading-icon {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #ccc;
            border-top-color: #FFD700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg);
            }
        }

        /* AI Page Styles */
        .ai-page {
            background: #111827;
            min-height: 100vh;
            color: #f3f4f6;
        }
        .ai-header {
            background-color: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }
        .chat-bubble {
            background-color: rgba(55, 65, 81, 0.7);
            backdrop-filter: blur(3px);
        }
        .ai-icon-container {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }
        .ai-chat-input-container {
            background-color: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(5px);
        }
    </style>
</head>

<body class="bg-gray-900 text-gray-200 transition-colors duration-500">

    <div id="welcome-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center p-4">
        <div class="relative w-full max-w-xl text-center">
            <h3 class="text-4xl sm:text-5xl font-bold text-white mb-8 transition-all duration-1000 ease-in-out transform -translate-y-10 opacity-0" id="welcome-title" style="font-family: 'MCS Hijaz S_U normal', serif;">بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيمِ</h3>
            <p class="text-xl sm:text-2xl 
 text-white italic mb-4 transition-all duration-1000 ease-in-out transform translate-y-10 opacity-0" id="welcome-subtitle">
                Selamat Datang di Aplikasi SantriQ
            </p>
            <p class="text-lg text-white transition-all duration-1000 ease-in-out transform translate-y-10 opacity-0" id="welcome-message">
                Semoga Allah memberkahi langkah-langkah kita dalam menuntut ilmu.
 </p>
        </div>
    </div>

    <div id="app" class="container mx-auto p-4 md:p-8 max-w-7xl">
        <div id="role-selection-page" class="flex flex-col items-center justify-center min-h-screen p-4 bg-gray-900">
            <div class="fixed top-8 right-8 z-50 flex items-center space-x-2">
                <button id="theme-toggle" class="bg-gray-800 rounded-full w-10 h-10 flex items-center justify-center shadow-md">
          
          <i id="theme-icon" class="fas fa-moon text-gray-200"></i>
                </button>
            </div>
            <div class="fixed top-8 z-50">
                <select id="language-selector" onchange="setLanguage(this.value)" class="bg-gray-800 text-gray-200 border border-gray-700 rounded-full shadow-md py-2 px-4 focus:ring-yellow-400 focus:border-yellow-400">
               
      <option value="id">Bahasa Indonesia</option>
                    <option value="en">English</option>
                    <option value="ja">日本語</option>
                    <option value="ar">العربية</option>
                    <option value="ru">Русский</option>
         
            <option value="jw">Basa Jawa</option>
                </select>
            </div>
            <div class="w-full max-w-sm p-8 space-y-6 bg-gray-800 rounded-xl shadow-2xl text-center relative modern-panel">
                <p class="text-4xl text-yellow-400" style="font-family: 'MCS Hijaz S_U normal', serif;">بسم الله الرحمن الرحيم</p>
          
          <h2 class="text-2xl font-bold text-gray-100">Selamat Datang di Aplikasi SantriQ</h2>
                <p class="text-gray-400">Silakan pilih peran Anda untuk melanjutkan:</p>
                <div class="space-y-4 pt-4">
                    <button onclick="showFeedPage('public')" class="w-full px-4 py-3 font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
                  
              Beranda
                    </button>
                    <button onclick="handleRoleSelection('wali')" class="w-full px-4 py-3 font-semibold text-white bg-teal-700 rounded-lg hover:bg-teal-800">
                        Saya Wali Santri
                   
  </button>
                    <button onclick="handleRoleSelection('guru')" class="w-full px-4 py-3 font-semibold text-gray-900 bg-yellow-100 rounded-lg hover:bg-yellow-200">
                        Saya Pengurus / Guru
                    </button>
                    <button onclick="showAiPage()" class="w-full 
 px-4 py-3 font-semibold text-white bg-indigo-700 rounded-lg hover:bg-indigo-800">
                        Akang Nahya
                    </button>
                </div>
            </div>
            <div class="flex flex-col items-center mt-8 w-full max-w-sm mx-auto space-y-6">
 
                <div class="flex flex-wrap justify-center space-x-4 futuristic-icon-panel">
                    <div class="feature-tooltip relative">
                        <div class="w-12 h-12 bg-gray-800 rounded-full shadow-md flex items-center justify-center icon-item">
                         
              <i class="fas fa-chart-line h-6 w-6"></i>
                        </div>
                        <span data-translate-key="tooltip_realtime" class="tooltip-text">Monitoring Real-time</span>
                    </div>
                    <div class="feature-tooltip 
 relative">
                        <div class="w-12 h-12 bg-gray-800 rounded-full shadow-md flex items-center justify-center icon-item">
                            <i class="fas fa-users-cog h-6 w-6"></i>
                        </div>
           
              <span data-translate-key="tooltip_guardian" class="tooltip-text">Akses Wali Santri</span>
                    </div>
                    <div class="feature-tooltip relative">
                        <div class="w-12 h-12 bg-gray-800 rounded-full shadow-md flex items-center justify-center icon-item">
        
                      <i class="fas fa-file-alt h-6 w-6"></i>
                        </div>
                        <span data-translate-key="tooltip_report" class="tooltip-text">Laporan Terstruktur</span>
                    </div>
     
            </div>
                <div class="text-left text-center">
                    <p data-translate-key="hadith_text" class="text-sm italic text-gray-400 mt-2">"Sebaik-baik kalian adalah orang<br>yang belajar Al-Qur'an dan mengajarkannya."</p>
                </div>
            </div>
           
  <footer class="mt-8 text-center text-sm text-gray-500">
                <button onclick="showAboutPage()" class="text-yellow-400 hover:text-yellow-500 underline mb-2">Tentang Aplikasi</button>
                <p data-translate-key="footer_text">Project dibuat oleh (MUHAMMAD NAHYA FADLALLAH) ©2025 All Rights Reserved</p>
                <a href="https://wa.me/6285520767908" target="_blank" class="block mt-4 text-center">
                    <span data-translate-key="complaint_info" class="text-sm font-semibold text-gray-400">PUSAT BANTUAN</span>
 
                </a>
            </footer>
        </div>

        <div id="pondok-register-page" class="hidden flex-col items-center justify-center min-h-screen p-4 bg-gray-900">
            <div class="w-full max-w-sm p-8 space-y-6 bg-gray-800 rounded-xl shadow-2xl relative modern-panel">
                <h2 class="text-2xl font-bold text-center text-gray-100">Daftarkan Pondok Anda</h2>
      
          <form id="pondok-register-form" class="space-y-6">
                    <div>
                        <label for="register-pondok-id" class="block text-sm font-medium text-gray-300">Nama Pondok & Nomor Unik</label>
                        <input type="text" id="register-pondok-id" placeholder="Contoh: PPTI#12345" class="mt-1 w-full px-4 py-3 border border-gray-600 
 rounded-lg focus:ring-4 focus:ring-yellow-200 bg-gray-700 text-gray-200" required>
                        <p class="text-xs text-gray-500 mt-1">Gunakan tanda pagar (#) untuk memisahkan nama dan nomor unik.</p>
                    </div>
                    <div>
                   
          <label for="register-password" class="block text-sm font-medium text-gray-300">Buat Kata Sandi</label>
                        <div class="relative mt-1">
                            <input type="password" id="register-password" placeholder="Minimal 6 karakter" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-4 focus:ring-yellow-200 bg-gray-700 text-gray-200" required>
                  
              <button type="button" onclick="togglePasswordVisibility('register-password', this)" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5">
                                <i class="fas fa-eye text-gray-500"></i>
                            </button>
                
          </div>
                    </div>
                    <button type="submit" class="w-full px-4 py-3 font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
                        Daftar
                   
  </button>
                </form>
                <p id="register-error" class="text-red-500 text-sm mt-2 hidden text-center"></p>
                <p class="text-center text-sm text-gray-400">
                    Sudah punya akun?
 <button onclick="showPage('pondokLogin')" class="font-semibold text-yellow-400 hover:underline">Masuk di sini</button>
                </p>
                <p class="text-center text-sm mt-4 text-gray-500">
                    <button onclick="showPage('roleSelection')" class="hover:underline">Kembali ke pilihan peran</button>
                </p>
            </div>
     
    </div>

        <div id="pondok-login-page" class="hidden flex-col items-center justify-center min-h-screen p-4 bg-gray-900">
            <div class="w-full max-w-sm p-8 space-y-6 bg-gray-800 rounded-xl shadow-2xl relative modern-panel">
                <p class="text-4xl text-yellow-400 text-center" style="font-family: 'MCS Hijaz S_U normal', serif;">بسم الله الرحمن الرحيم</p>
                <h2 class="text-2xl font-bold text-center text-gray-100">Login Pengurus / Guru</h2>
         
        <form id="pondok-login-form" class="space-y-6">
                    <div>
                        <label for="login-pondok-id" class="block text-sm font-medium text-gray-300">Nama Pondok & Nomor Unik</label>
                        <input type="text" id="login-pondok-id" placeholder="Contoh: PPTI#12345" class="mt-1 w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-4 focus:ring-yellow-200 
 bg-gray-700 text-gray-200" required>
                    </div>
                    <div>
                        <label for="login-password" class="block text-sm font-medium text-gray-300">Kata Sandi</label>
                        <div class="relative mt-1">
  
                            <input type="password" id="login-password" placeholder="Kata Sandi Anda" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-4 focus:ring-yellow-200 bg-gray-700 text-gray-200" required>
                            <button type="button" onclick="togglePasswordVisibility('login-password', this)" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5">
                   
              <i class="fas fa-eye text-gray-500"></i>
                            </button>
                        </div>
                    </div>
            
          <button type="submit" class="w-full px-4 py-3 font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
                        Login
                    </button>
                </form>
                <p id="pondok-login-error" class="text-red-500 text-sm mt-2 hidden text-center"></p>
 
                <p class="text-center text-sm text-gray-400">
                    Belum punya akun?
 <button onclick="showPage('pondokRegister')" class="font-semibold text-yellow-400 hover:underline">Daftar di sini</button>
                </p>
                <p class="text-center text-sm mt-4 text-gray-500">
                    <button onclick="showPage('roleSelection')" class="hover:underline">Kembali ke pilihan peran</button>
                </p>
            </div>
     
    </div>

        <div id="access-code-page" class="hidden flex-col items-center justify-center min-h-screen p-4 bg-gray-900">
            <div class="w-full max-w-sm p-8 space-y-6 bg-gray-800 rounded-xl shadow-2xl relative modern-panel">
                <p class="text-4xl text-yellow-400 text-center" style="font-family: 'MCS Hijaz S_U normal', serif;">بسم الله الرحمن الرحيم</p>
                <h2 class="text-2xl font-bold text-center text-gray-100">Kode Akses Wali Santri</h2>
         
        <p class="text-sm text-center text-gray-400">Silakan masukkan kode akses yang diberikan oleh pengurus.</p>
                <form id="access-code-form" class="space-y-6">
                    <div>
                        <label for="access-code" class="block text-sm font-medium text-gray-300">Kode Akses</label>
               
          <input type="text" id="access-code" placeholder="Masukkan kode" class="mt-1 w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-4 focus:ring-yellow-200 bg-gray-700 text-gray-200" required>
                    </div>
                    <button type="submit" class="w-full px-4 py-3 font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
                        Masuk
  
                   </button>
                </form>
                <p id="access-code-error" class="text-red-500 text-sm mt-2 hidden text-center"></p>
                <p class="text-center text-sm mt-4 text-gray-500">
                    <button onclick="showPage('roleSelection')" class="hover:underline">Kembali ke 
 pilihan peran</button>
                </p>
            </div>
        </div>

        <div id="wali-dashboard-page" class="hidden fade-in main-content p-8 rounded-xl shadow-lg flex flex-col h-screen">
            <header class="flex flex-col items-center justify-center text-center mb-8 pb-4 border-b border-gray-700 flex-shrink-0">
                <h1 class="text-3xl font-bold text-yellow-400">Dashboard Wali Santri</h1>
  
               <p class="text-gray-400">Pilih kelas anak Anda untuk melihat detail progres hafalan.</p>
                <div class="w-full md:w-auto mt-4 md:mt-0 flex flex-wrap justify-center items-center space-x-2 space-y-2 md:space-x-4 md:space-y-0">
                    <button onclick="showJadwalDonasiPage()" class="px-4 py-2 font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">Jadwal & Donasi</button>
                   
  <button onclick="logout()" class="px-4 py-2 font-semibold text-white bg-gray-700 rounded-lg hover:bg-gray-600">Keluar</button>
                </div>
            </header>
            <div id="kelas-list-container" class="overflow-y-auto flex-grow px-2 py-4">
                <div id="kelas-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                    </div>
            </div>
            <div id="santri-list-container" class="hidden overflow-y-auto flex-grow px-2 py-4">
                <button onclick="backToWaliDashboard()" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 
 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    Kembali ke Daftar Kelas
         
        </button>
                <h2 id="current-class-title" class="text-2xl font-bold mb-4 text-gray-100 text-center"></h2>
                <div id="santri-gallery" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                </div>
                <p id="no-results" class="text-center text-gray-500 py-10 hidden">Santri tidak ditemukan.</p>
         
    </div>
        </div>

        <div id="detail-santri-page" class="hidden fade-in p-4 bg-gray-900">
            <header class="mb-4">
                <button onclick="showSantriListByKelas(sessionStorage.getItem('currentWaliKelas'))" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
           
              <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                    Kembali ke Daftar Santri
                </button>
      
          </header>
            <div class="bg-gray-800 p-8 rounded-xl shadow-lg relative main-content">
                <div class="flex flex-col items-center md:flex-row md:items-start text-center md:text-left md:space-x-8 pb-8 border-b border-gray-700">
                    <img id="detail-foto" src="" alt="Foto Santri" class="w-32 h-32 rounded-full object-cover border-4 border-yellow-400 shadow-md mb-4 md:mb-0" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=Error';">
               
      <div class="flex flex-col items-center md:items-start">
                        <h2 id="detail-nama" class="text-3xl font-bold text-gray-100"></h2>
                        <p id="detail-kelas" class="text-xl text-gray-400"></p>
                        <p id="detail-pengajar" class="text-md text-yellow-400 font-semibold mt-1"></p>
       
                  <div id="detail-status-target" class="mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold"></div>
                    </div>
                </div>
                <div class="py-8 border-b border-gray-700">
                   
  <h3 class="text-2xl font-bold mb-6 text-center text-yellow-400">Grafik Progres Santri</h3>
                    <div id="progress-charts" class="space-y-4">
                        <div id="chart-daily"></div>
                        <div id="chart-weekly"></div>
                    
      <div id="chart-monthly"></div>
                        <div id="chart-yearly"></div>
                    </div>
                </div>
                <div class="py-8 border-b border-gray-700">
               
      <h3 class="text-2xl font-bold mb-6 text-center text-yellow-400">Laporan Pencapaian Target</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 text-center">
                        <div class="bg-gray-700 p-4 rounded-lg shadow-sm">
                            <p class="text-sm font-medium text-gray-400">Total Hafalan Juz</p>
 
                            <p id="total-hafalan-juz" class="text-lg font-bold text-yellow-400"></p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-lg shadow-sm">
                 
                <p class="text-sm font-medium text-gray-400">Target Harian</p>
                            <p id="target-harian" class="text-lg font-bold text-yellow-400"></p>
                        </div>
                        <div class="bg-gray-700 p-4 rounded-lg shadow-sm">
 
                            <p class="text-sm font-medium text-gray-400">Target Mingguan</p>
                            <p id="target-mingguan" class="text-lg font-bold text-yellow-400"></p>
                        </div>
             
            <div class="bg-gray-700 p-4 rounded-lg shadow-sm">
                            <p class="text-sm font-medium text-gray-400">Target Bulanan</p>
                            <p id="target-bulanan" class="text-lg font-bold text-yellow-400"></p>
                     
    </div>
                        <div class="bg-gray-700 p-4 rounded-lg shadow-sm">
                            <p class="text-sm font-medium text-gray-400">Target Tahunan</p>
                            <p id="target-tahunan" class="text-lg font-bold text-yellow-400"></p>
                        </div>
                    </div>
                </div>
                <div class="pt-8">
                    <h3 class="text-2xl font-bold mb-6 text-center text-yellow-400">Riwayat Setoran Hafalan</h3>
                 
    <div class="overflow-x-auto">
                        <table class="min-w-full bg-gray-800">
                            <thead class="bg-gray-700">
                                <tr>
         
                            <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Tanggal</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Setoran</th>
                     
                <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Jenis</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Penilaian Guru</th>
                                
 </tr>
                            </thead>
                            <tbody id="hafalan-history" class="divide-y divide-gray-700"></tbody>
                        </table>
                 
    </div>
                </div>
            </div>
        </div>

        <div id="jadwal-donasi-page" class="hidden fade-in p-4 bg-gray-900">
            <header class="mb-4">
                <button onclick="goBackFromJadwal()" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
            
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                    </svg>
                 
    Kembali ke Dashboard
                </button>
            </header>
            <div class="bg-gray-800 p-8 rounded-xl shadow-lg space-y-12 relative main-content">
                <div>
                    <h2 class="text-3xl font-bold text-center text-yellow-400 mb-2">Jadwal Solat Hari Ini</h2>
    
                  <div class="flex flex-col md:flex-row items-center justify-center space-x-3 my-4">
                        <label for="alarm-toggle" class="font-semibold text-gray-300">Alarm Azan:</label>
                        <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                
              <input type="checkbox" name="alarm-toggle" id="alarm-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" />
                            <label for="alarm-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-700 cursor-pointer"></label>
                        </div>
              
          </div>
                    <p id="jadwal-lokasi" class="text-center text-gray-400 mb-6">Memuat data untuk lokasi anda...</p>
                    <div id="jadwal-sholat-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 text-center">
                    </div>
                </div>
   
              <div>
                    <h2 class="text-3xl font-bold text-center text-yellow-400 mb-6">Donasi Pengembangan Aplikasi</h2>
                    <div class="max-w-md mx-auto bg-gray-700 p-6 rounded-lg text-center shadow-sm">
                        <p class="text-gray-300 mb-4">Dukungan anda sangat berarti bagi kami untuk 
 terus mengembangkan aplikasi ini agar lebih bermanfaat bagi ummat. Salurkan donasi terbaik anda melalui e-wallet berikut:</p>
                        <div class="flex items-center justify-center space-x-2 my-4">
                            <span id="donation-number" class="text-2xl font-bold text-gray-200 bg-gray-800 py-3 px-4 rounded-md border-2 border-dashed border-gray-600">0856 3777 508</span>
               
              <button onclick="copyDonationNumber()" class="px-4 py-3 text-sm font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">Salin</button>
                        </div>
                        <div class="flex justify-center space-x-4 mt-4">
                          
              <img src="https://upload.wikimedia.org/wikipedia/commons/7/72/Logo_dana_blue.svg" alt="DANA" class="h-8">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/e/eb/Logo_ovo_purple.svg" alt="OVO" class="h-8">
                        </div>
                        <p class="text-sm text-gray-400 mt-4">a.n.
 Tim Pengembang MUHAMMAD NAHYA FADLALLAH</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="guru-dashboard-page" class="hidden fade-in main-content p-8 rounded-xl shadow-lg flex flex-col h-screen">
            <header class="flex flex-col items-center justify-center text-center mb-8 pb-4 border-b border-gray-700 
 flex-shrink-0">
                <h1 class="text-3xl font-bold text-yellow-400">Panel Guru</h1>
                <p class="text-gray-400 mb-4">Kelola data hafalan santri.</p>
                <div class="flex items-center space-x-2 mt-2 flex-wrap justify-center">
                    <button onclick="showJadwalDonasiPage()" class="px-3 py-2 text-sm font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">Jadwal & Donasi</button>
      
               <button onclick="showGuruManagementPage()" class="px-3 py-2 text-sm font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
                        Kelola Data Guru
                    </button>
                    <button onclick="showGuruForm(null)" class="px-3 py-2 text-sm font-semibold text-black bg-yellow-400 rounded-lg hover:bg-yellow-500">
  
                       + Tambah Santri Baru
                    </button>
                    <button onclick="logout()" class="px-3 py-2 text-sm font-semibold text-red-600 bg-red-100 rounded-lg hover:bg-red-200">Keluar</button>
                </div>
            </header>
            <div id="santri-grid-container" class="overflow-y-auto flex-grow px-2">
                <div id="guru-santri-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                </div>
            </div>
            <div id="unique-access-code-section" class="bg-gray-700 p-6 rounded-lg shadow-inner mt-8 text-center flex-shrink-0">
           
      <h3 class="text-xl font-bold text-yellow-400 mb-4">Kode Akses Wali Santri</h3>
                <div class="flex flex-col sm:flex-row items-center justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <p id="unique-access-code" class="text-2xl font-mono tracking-widest text-gray-200 p-2 bg-gray-800 rounded-md border border-yellow-400 shadow-sm"></p>
                    <button onclick="copyAccessCode()" class="px-4 py-2 bg-yellow-400 text-black rounded-md hover:bg-yellow-500">
      
                   Salin Kode
                    </button>
                    <a id="whatsapp-link" href="#" target="_blank" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
             
                        <path d="M12.04 2.167c-5.495 0-9.96 4.465-9.96 9.96 0 1.634.437 3.275 1.258 4.71L2.16 21.84l4.966-1.306c1.37.78 2.912 1.185 4.914 1.185 5.494 0 9.96-4.465 9.96-9.96 0-5.495-4.466-9.96-9.96-9.96zM17.47 16.32c-.156.467-.936.463-1.603.224-.666-.238-2.618-1.01-3.036-1.166-.418-.157-.723-.235-1.028.235-.305.47-.936 1.165-1.14 1.413-.204.248-.408.27-.76.092-.352-.178-1.464-.539-2.79-1.722-1.028-.9-1.714-2.28-1.92-2.65-.204-.37-.02-.574.156-.76.155-.178.303-.306.46-.539.155-.234.204-.418.305-.652.102-.234.05-.438-.02-.652-.07-.215-.65-.585-.898-.82-.248-.235-.497-.196-.701-.196-.205 0-.46-.079-.708-.079-.247 0-.666.236-.936.63-.27.394-.97 1.173-.97 2.858 0 1.685 1.002 3.308 1.142 3.556.14.248 1.968 3.018 4.8 4.228 2.834 1.21 2.834.814 3.33 1.05.496.236.936.204 1.306.027.37-.177 1.092-.497 1.248-.73.155-.233.223-.448.33-.63z" />
                        </svg>
                        Bagikan di WhatsApp
                    </a>
                </div>
            </div>
            <div id="guru-form-page" class="hidden fade-in p-4 bg-gray-900">
                <header class="mb-4">
                    <button onclick="backToGuruDashboard()" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Kembali ke Panel Guru
                    </button>
                </header>
                <div class="bg-gray-800 p-8 rounded-xl shadow-lg max-w-4xl mx-auto relative main-content">
                    <h2 id="form-title" class="text-2xl font-bold mb-6 text-yellow-400"></h2>
                    <form id="santri-form" class="space-y-6" enctype="multipart/form-data">
                        <input type="hidden" id="santri-id">
                        <input type="hidden" id="current-photo-url">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="nama" class="block text-sm font-medium text-gray-300">Nama Lengkap Santri</label>
                                <input type="text" id="nama" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-yellow-400 focus:border-yellow-400 bg-gray-700 text-gray-200" required>
                            </div>
                            <div>
                                <label for="kelas" class="block text-sm font-medium text-gray-300">Kelas</label>
                                <select id="kelas" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-yellow-400 focus:border-yellow-400 bg-gray-700 text-gray-200" required></select>
                            </div>
                            <div>
                                <label for="total-hafalan-juz" class="block text-sm font-medium text-gray-300">Total Hafalan Juz</label>
                                <input type="number" id="total-hafalan-juz" placeholder="Contoh: 5" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-yellow-400 focus:border-yellow-400 bg-gray-700 text-gray-200">
                            </div>
                        </div>
                        <div>
                            <label for="foto" class="block text-sm font-medium text-gray-300">Unggah Foto Santri</label>
                            <input type="file" id="foto" name="file" accept="image/*" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-700 text-gray-200">
                            <p id="foto-status" class="text-sm text-gray-400 mt-2"></p>
                        </div>
                        <div class="pt-4 border-t border-gray-700">
                            <h3 class="text-lg font-medium text-gray-100">Data Target Hafalan</h3>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="form-target-harian" class="block text-sm font-medium text-gray-300">Target Harian</label>
                                <select id="form-target-harian" class="mt-1 block w-full border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-700 text-gray-200"></select>
                            </div>
                            <div>
                                <label for="form-target-mingguan" class="block text-sm font-medium text-gray-300">Target Mingguan</label>
                                <select id="form-target-mingguan" class="mt-1 block w-full border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-700 text-gray-200"></select>
                            </div>
                            <div>
                                <label for="form-target-bulanan" class="block text-sm font-medium text-gray-300">Target Bulanan</label>
                                <input type="text" id="form-target-bulanan" placeholder="Contoh: 1 Juz" class="mt-1 block w-full border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-700 text-gray-200" required>
                            </div>
                            <div>
                                <label for="form-target-tahunan" class="block text-sm font-medium text-gray-300">Target Tahunan</label>
                                <input type="text" id="form-target-tahunan" placeholder="Contoh: 5 Juz" class="mt-1 block w-full border-gray-600 rounded-md shadow-sm py-2 px-3 bg-gray-700 text-gray-200" required>
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300">Status Pencapaian Target</label>
                            <div class="mt-2 flex items-center space-x-4">
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tercapai" value="true" class="form-radio h-4 w-4 text-yellow-400">
                                    <span class="ml-2 text-gray-300">Mencapai Target</span>
                                </label>
                                <label class="inline-flex items-center">
                                    <input type="radio" name="tercapai" value="false" class="form-radio h-4 w-4 text-yellow-400">
                                    <span class="ml-2 text-gray-300">Belum Mencapai Target</span>
                                </label>
                            </div>
                        </div>
                        <div class="flex justify-end pt-2">
                            <button type="submit" class="px-6 py-2 bg-yellow-400 text-black rounded-md hover:bg-yellow-500">Simpan Data Santri</button>
                        </div>
                    </form>
                    <div id="hafalan-management-section" class="hidden pt-8 border-t border-gray-700 mt-8">
                        <h3 class="text-xl font-bold mb-4 text-yellow-400">Kelola Setoran Hafalan</h3>
                        <form id="hafalan-form" class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end bg-gray-700 p-4 rounded-lg mb-6">
                            <div>
                                <label for="hafalan-tanggal" class="block text-sm font-medium text-gray-300">Tanggal</label>
                                <input type="date" id="hafalan-tanggal" class="mt-1 w-full border-gray-600 rounded-md bg-gray-800 text-gray-200" required>
                            </div>
                            <div>
                                <label for="hafalan-setoran" class="block text-sm font-medium text-gray-300">Setoran</label>
                                <input type="text" id="hafalan-setoran" placeholder="Contoh: An-Naba: 1-20" class="mt-1 w-full border-gray-600 rounded-md bg-gray-800 text-gray-200" required>
                            </div>
                            <div>
                                <label for="hafalan-jenis" class="block text-sm font-medium text-gray-300">Jenis</label>
                                <select id="hafalan-jenis" class="mt-1 w-full border-gray-600 rounded-md bg-gray-800 text-gray-200">
                                    <option>Hafalan Baru</option>
                                    <option>Muroja'ah</option>
                                </select>
                            </div>
                            <div>
                                <label for="hafalan-penilaian" class="block text-sm font-medium text-gray-300">Penilaian</label>
                                <select id="hafalan-penilaian" class="mt-1 w-full border-gray-600 rounded-md bg-gray-800 text-gray-200">
                                    <option>Lancar</option>
                                    <option>Perlu Diulang</option>
                                </select>
                            </div>
                            <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-md hover:bg-green-700">Tambah</button>
                        </form>
                        <div class="overflow-x-auto">
                            <table class="min-w-full bg-gray-800">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="py-2 px-4 text-left text-xs font-medium uppercase text-gray-400">Tanggal</th>
                                        <th class="py-2 px-4 text-left text-xs font-medium uppercase text-gray-400">Setoran</th>
                                        <th class="py-2 px-4 text-left text-xs font-medium uppercase text-gray-400">Jenis</th>
                                        <th class="py-2 px-4 text-left text-xs font-medium uppercase text-gray-400">Penilaian</th>
                                        <th class="py-2 px-4 text-left text-xs font-medium uppercase text-gray-400">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="guru-hafalan-table" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div id="guru-management-page" class="hidden fade-in p-4 bg-gray-900">
                <header class="mb-4">
                    <button onclick="backToGuruDashboard()" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Kembali ke Panel Guru
                    </button>
                </header>
                <div class="bg-gray-800 p-8 rounded-xl shadow-lg max-w-4xl mx-auto relative main-content">
                    <h2 class="text-2xl font-bold mb-6 text-yellow-400">Kelola Data Guru</h2>
                    <form id="guru-form" class="space-y-4 bg-gray-700 p-6 rounded-lg mb-8">
                        <input type="hidden" id="guru-id">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                            <div>
                                <label for="guru-nama" class="block text-sm font-medium text-gray-300">Nama Guru (Ustadz/Ustadzah)</label>
                                <input type="text" id="guru-nama" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-yellow-400 focus:border-yellow-400 bg-gray-800 text-gray-200" required>
                            </div>
                            <div>
                                <label for="guru-kelas" class="block text-sm font-medium text-gray-300">Mengajar Kelas</label>
                                <select id="guru-kelas" class="mt-1 block w-full border border-gray-600 rounded-md shadow-sm py-2 px-3 focus:ring-yellow-400 focus:border-yellow-400 bg-gray-800 text-gray-200" required></select>
                            </div>
                            <button type="submit" class="px-6 py-2 bg-yellow-400 text-black rounded-md hover:bg-yellow-500 w-full">Simpan Guru</button>
                        </div>
                    </form>
                    <h3 class="text-xl font-bold mb-4 text-yellow-400">Daftar Guru Terdaftar</h3>
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-gray-800">
                            <thead class="bg-gray-700">
                                <tr>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase">Nama Guru</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase">Mengajar Kelas</th>
                                    <th class="py-3 px-6 text-left text-xs font-medium text-gray-400 uppercase">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="guru-list-table" class="divide-y divide-gray-700"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div id="feed-page" class="hidden fade-in main-content p-8 rounded-xl shadow-lg flex flex-col h-screen">
                <header class="flex-shrink-0 mb-6 flex justify-between items-center">
                    <button onclick="backFromFeed()" class="flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Kembali
                    </button>
                    <h1 class="text-3xl font-bold text-yellow-400 text-center flex-grow">Beranda Publik</h1>
                    <button onclick="showPostForm()" class="bg-yellow-400 text-black px-4 py-2 rounded-lg hover:bg-yellow-500">
                        Buat Postingan
                    </button>
                </header>
                <div id="post-form-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
                    <div class="bg-gray-800 rounded-xl shadow-2xl p-6 w-full max-w-md">
                        <h2 class="text-xl font-bold mb-4 text-yellow-400">Buat Postingan Baru</h2>
                        <form id="new-post-form" class="space-y-4">
                            <textarea id="post-text" placeholder="Apa yang ingin Anda bagikan?" class="w-full h-24 p-2 border rounded-md bg-gray-700 text-gray-200"></textarea>
                            <input type="file" id="post-media" accept="image/*,video/*" class="w-full p-2 border rounded-md bg-gray-700 text-gray-200">
                            <div class="flex justify-end space-x-2">
                                <button type="button" onclick="closePostForm()" class="px-4 py-2 bg-gray-600 text-gray-200 rounded-md">Batal</button>
                                <button type="submit" class="px-4 py-2 bg-yellow-400 text-black rounded-md hover:bg-yellow-500">Unggah</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div id="feed-container" class="overflow-y-auto flex-grow px-2 space-y-6">
                    </div>
            </div>
            <div id="about-page" class="hidden fade-in p-4 bg-gray-900">
                <header class="mb-4">
                    <button onclick="showPage('roleSelection')" class="mb-4 flex items-center text-yellow-400 hover:text-yellow-500 font-semibold">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                        </svg>
                        Kembali
                    </button>
                </header>
                <div class="bg-gray-800 p-8 rounded-xl shadow-lg max-w-4xl mx-auto relative main-content">
                    <h2 class="text-3xl font-bold text-center text-yellow-400 mb-6">Tentang Aplikasi Monitoring Hafalan</h2>
                    <div class="space-y-6 text-gray-300 leading-relaxed">
                        <section>
                            <h3 class="text-xl font-semibold text-yellow-400 mb-2">Latar Belakang Pembuatan</h3>
                            <p>
                                Dalam dunia pendidikan Islam, khususnya di pondok pesantren tahfidz, proses memonitor perkembangan hafalan Al-Qur'an setiap santri adalah sebuah tugas yang krusial namun seringkali menantang. Guru (Ustadz/Ustadzah) harus mencatat setiap setoran, mengidentifikasi kelemahan, dan melaporkannya kepada wali santri. Di sisi lain, wali santri seringkali merasa kesulitan untuk mendapatkan informasi yang real-time dan terstruktur mengenai progres anak-anak mereka. Proses yang masih manual menggunakan buku atau catatan terpisah rentan terhadap kesalahan, kehilangan data, dan memakan waktu. Aplikasi ini lahir dari kebutuhan untuk menjembatani kesenjangan komunikasi tersebut dan mendigitalisasi proses monitoring agar lebih efisien, transparan, dan akurat.
                            </p>
                        </section>
                        <section>
                            <h3 class="text-xl font-semibold text-yellow-400 mb-2">Tujuan Utama Aplikasi</h3>
                            <p>
                                Tujuan utama kami mengembangkan platform ini adalah untuk menciptakan sebuah ekosistem digital yang terintegrasi bagi pondok pesantren, yang berfokus pada tiga pilar utama:
                            </p>
                            <ul class="list-disc list-inside pl-4 mt-2 space-y-1">
                                <li><strong>Memudahkan Guru:</strong> Menyediakan alat yang praktis bagi para guru untuk mencatat, mengelola, dan menganalisis data hafalan santri dengan cepat dan mudah, sehingga mereka dapat lebih fokus pada proses pengajaran.</li>
                                <li><strong>Memberikan Ketenangan bagi Wali Santri:</strong> Memberikan akses langsung kepada wali santri untuk memantau pencapaian, riwayat setoran, dan target hafalan anak mereka kapan saja dan di mana saja.</li>
                                <li><strong>Meningkatkan Motivasi Santri:</strong> Dengan adanya target yang jelas dan progres yang dapat dilihat secara visual, kami berharap para santri akan lebih termotivasi untuk mencapai target hafalan mereka.</li>
                            </ul>
                        </section>
                        <section>
                            <p class="text-center italic text-gray-400 pt-4 border-t border-gray-700 mt-8">
                                Kami percaya bahwa teknologi dapat menjadi alat yang ampuh untuk mendukung pendidikan Al-Qur'an. Semoga aplikasi ini dapat memberikan manfaat yang luas dan menjadi bagian dari ladang amal jariyah kita semua. Aamiin.
                            </p>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <audio id="azan-alarm" src="https://archive.org/download/AzanMakkah/Azan%20Makkah.mp3" preload="auto"></audio>
    <div id="alarm-notification" class="hidden fixed bottom-5 right-5 bg-yellow-400 text-black p-4 rounded-lg shadow-2xl z-50 transform transition-all duration-300">
        <div class="flex items-start">
            <div class="mr-3">
                <p class="font-bold text-lg" id="alarm-text"></p>
                <p class="text-sm">Waktunya menunaikan salat.</p>
            </div>
            <button onclick="dismissAlarm()" class="text-gray-800 hover:text-black">&times;</button>
        </div>
    </div>
    <div id="toast-container" class="fixed top-5 right-5 z-50"></div>
    <script>
        // --- TRANSLATION 
        const translations = {
            id: {
                app_title: "Monitoring Hafalan Santri",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>Selamat Datang!",
                login_welcome_text: "Terima kasih sudah mengunjungi aplikasi monitoring hafalan kami. Semoga bermanfaat.",
                login_title: "Sistem Monitoring Hafalan",
                login_subtitle: "Silakan masukkan kode akses untuk melanjutkan.",
                access_code_placeholder: "Kode Akses Anda",
                login_button: "Masuk",
                login_error: "Kode yang Anda masukkan salah.",
                hadith_text: "\"Sebaik-baik kalian adalah orang<br>yang belajar Al-Qur'an dan mengajarkannya.\"",
                tooltip_realtime: "Monitoring Real-time",
                tooltip_guardian: "Akses Wali Santri",
                tooltip_report: "Laporan Terstruktur",
                footer_text: "Project dibuat oleh (MUHAMMAD NAHYA FADLALLAH) © 2025 All Rights Reserved",
                unique_code_copied: "Kode akses berhasil disalin!",
                complaint_info: "PUSAT BANTUAN",
                ai_welcome: "Halo semuanya! Akang Nahya di sini. Ada yang mau curhat atau tanya-tanya? Santai aja, Akang siap dengerin dan bantu!"
            },
            en: {
                app_title: "Student Memorization Monitoring",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>Welcome!",
                login_welcome_text: "Thank you for visiting our memorization monitoring application. We hope you find it useful.",
                login_title: "Memorization Monitoring System",
                login_subtitle: "Please enter the access code to continue.",
                access_code_placeholder: "Your Access Code",
                login_button: "Login",
                login_error: "The code you entered is incorrect.",
                hadith_text: "\"The best of you are those<br>who learn the Qur'an and teach it.\"",
                tooltip_realtime: "Real-time Monitoring",
                tooltip_guardian: "Guardian Access",
                tooltip_report: "Structured Reports",
                footer_text: "Project created by the team (muhammad nahya fadlallah)",
                unique_code_copied: "Access code copied successfully!",
                complaint_info: "Complaint Info",
                ai_welcome: "Hello everyone! Akang Nahya is here. Anyone want to vent or ask questions? Just chill, Akang is ready to listen and help!"
            },
            ja: {
                app_title: "生徒の暗記モニタリング",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>ようこそ！",
                login_welcome_text: "私たちの暗記モニタリングアプリケーションをご覧いただきありがとうございます。お役に立てば幸いです。",
                login_title: "暗記モニタリングシステム",
                login_subtitle: "続行するにはアクセスコードを入力してください。",
                access_code_placeholder: "アクセスコード",
                login_button: "ログイン",
                login_error: "入力したコードが間違っています。",
                hadith_text: "「あなた方の中で最も優れた者は<br>クルアーンを学び、それを教える者である。」",
                tooltip_realtime: "リアルタイムモニタリング",
                tooltip_guardian: "保護者アクセス",
                tooltip_report: "構造化レポート",
                footer_text: "プロジェクト作成者チーム (muhammad nahya fadlallah)",
                unique_code_copied: "アクセスコードが正常にコピーされました！",
                complaint_info: "苦情情報",
                ai_welcome: "皆さん、こんにちは！アカンのナヒャです。おしゃべりしたり、質問したりしたいことはありますか？ Akangが聞いて助ける準備ができています！"
            },
            ar: {
                app_title: "مراقبة حفظ الطلاب",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>أهلاً وسهلاً!",
                login_welcome_text: "شكراً لزيارتكم تطبيقنا لمراقبة الحفظ. نأمل أن يكون مفيداً لكم.",
                login_title: "نظام مراقبة الحفظ",
                login_subtitle: "الرجاء إدخال رمز الدخول للمتابعة.",
                access_code_placeholder: "رمز الدخول الخاص بك",
                login_button: "دخول",
                login_error: "الرمز الذي أدخلته غير صحيح.",
                hadith_text: "خيركم من تعلم القرآن وعلمه",
                tooltip_realtime: "مراقبة فورية",
                tooltip_guardian: "وصول ولي الأمر",
                tooltip_report: "تقارير منظمة",
                footer_text: "تم إنشاء المشروع بواسطة فريق (محمد نحيا فضل الله)",
                unique_code_copied: "تم نسخ رمز الدخول بنجاح!",
                complaint_info: "معلومات الشكوى",
                ai_welcome: "أهلاً بالجميع! أنا أكانج ناهيا هنا. هل هناك من يريد الدردشة أو طرح الأسئلة؟ كن على طبيعتك، أنا مستعد للاستماع والمساعدة!"
            },
            ru: {
                app_title: "Мониторинг запоминания студентов",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>Добро пожаловать!",
                login_welcome_text: "Спасибо, что посетили наше приложение для мониторинга запоминания. Надеемся, оно будет вам полезно.",
                login_title: "Система мониторинга запоминания",
                login_subtitle: "Пожалуйста, введите код доступа, чтобы продолжить.",
                access_code_placeholder: "Ваш код доступа",
                login_button: "Войти",
                login_error: "Вы ввели неверный код.",
                hadith_text: "\"Лучшими из вас являются те,<br>кто изучает Коран и учит ему других.\"",
                tooltip_realtime: "Мониторинг в реальном времени",
                tooltip_guardian: "Доступ для опекунов",
                tooltip_report: "Структурированные отчеты",
                footer_text: "Проект создан командой (мухаммад нахья фадлаллах)",
                unique_code_copied: "Код доступа успешно скопирован!",
                complaint_info: "Информация о жалобах",
                ai_welcome: "Всем привет! Это Аканг Нахья. Кто-нибудь хочет поболтать или задать вопросы? Расслабьтесь, я готов слушать и помогать!"
            },
            jw: {
                app_title: "Monitoring Apalan Santri",
                login_welcome: "السلام عليكم ورحمة الله وبركاته<br>Sugeng Rawuh!",
                login_welcome_text: "Matur nuwun sampun ngunjungi aplikasi monitoring apalan kita. Mugi-mugi mupangati.",
                login_title: "Sistem Monitoring Apalan",
                login_subtitle: "Monggo ketik kode akses kangge nglanjutaken.",
                access_code_placeholder: "Kode Akses Panjenengan",
                login_button: "Mlebet",
                login_error: "Kode ingkang panjenengan ketik salah.",
                hadith_text: "\"Sak apik-apike sliramu yaiku wong<br>sing sinau Al-Qur'an lan ngajarake.\"",
                tooltip_realtime: "Monitoring Real-time",
                tooltip_guardian: "Akses Wali Santri",
                tooltip_report: "Laporan Rapi",
                footer_text: "Proyek digarap dening tim (muhammad nahya fadlallah)",
                unique_code_copied: "Kode akses kasil disalin!",
                complaint_info: "Info Pengaduan",
                ai_welcome: "Halo kabeh! Akang Nahya ning kene. Ana sing arep curhat utawa takon-takon? Santai wae, Akang siap ngrungokake lan mbantu!"
            }
        };

        const pages = {
            roleSelection: document.getElementById('role-selection-page'),
            pondokRegister: document.getElementById('pondok-register-page'),
            pondokLogin: document.getElementById('pondok-login-page'),
            accessCode: document.getElementById('access-code-page'),
            waliDashboard: document.getElementById('wali-dashboard-page'),
            detailSantri: document.getElementById('detail-santri-page'),
            guruDashboard: document.getElementById('guru-dashboard-page'),
            guruForm: document.getElementById('guru-form-page'),
            guruManagement: document.getElementById('guru-management-page'),
            jadwalDonasi: document.getElementById('jadwal-donasi-page'),
            about: document.getElementById('about-page'),
            feedPage: document.getElementById('feed-page'),
            aiPage: document.getElementById('ai-page'),
        };

        let appDataCache = {};
        let loginContext = null;
        let chatHistory = [];
        const systemPrompt = "Anda adalah Akang Nahya. Anda memiliki persona Akang-akang yang bijak dan berwibawa, namun dengan gaya bahasa yang santai, modern, dan kekinian seperti anak muda. Jawab pertanyaan dengan bijak, berikan nasihat yang menenangkan, dan ajaklah pengguna bercanda jika situasinya memungkinkan. Gunakan bahasa yang santai dan akrab. Jangan gunakan salam pembuka di awal setiap jawaban, langsung saja ke inti pembicaraan. Akhiri setiap jawaban dengan motivasi atau doa yang singkat. Gunakan emoji yang relevan untuk memperkaya respons.";

        function setLanguage(lang) {
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
            const elements = document.querySelectorAll('[data-translate-key]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (translations[lang] && translations[lang][key]) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translations[lang][key];
                    } else {
                        el.innerHTML = translations[lang][key];
                    }
                }
            });
            if (translations[lang] && translations[lang].app_title) {
                document.title = translations[lang].app_title;
            }
            localStorage.setItem('selectedLanguage', lang);
        }

        function showPage(pageName) {
            Object.values(pages).forEach(page => {
                if (page) {
                    page.classList.add('hidden');
                    page.classList.remove('flex');
                }
            });
            if (pages[pageName]) {
                pages[pageName].classList.remove('hidden');
                pages[pageName].classList.add('flex');
            }
        }

        // FUNGSI NAVIGASI
        function checkLoginState() {
            const role = sessionStorage.getItem('role');
            const pondokDbId = sessionStorage.getItem('currentPondokId');
            if (role && pondokDbId) {
                if (role === 'guru') {
                    renderGuruDashboard();
                    showPage('guruDashboard');
                } else if (role === 'wali') {
                    renderWaliDashboard();
                    showPage('waliDashboard');
                }
            } else {
                showPage('roleSelection');
            }
        }

        function goBackFromJadwal() {
            const role = sessionStorage.getItem('role');
            if (role === 'guru') {
                backToGuruDashboard();
            } else if (role === 'wali') {
                backToWaliDashboard();
            } else {
                showPage('roleSelection');
            }
        }

        function backToWaliDashboard() {
            renderWaliDashboard();
            showPage('waliDashboard');
        }

        function backToGuruDashboard() {
            renderGuruDashboard();
            showPage('guruDashboard');
        }

        function backFromFeed() {
            const role = sessionStorage.getItem('role');
            if (role === 'guru') {
                showPage('guruDashboard');
            } else if (role === 'wali') {
                showPage('waliDashboard');
            } else {
                showPage('roleSelection');
            }
        }

        function showAiPage() {
            showPage('aiPage');
            const chatMessages = document.getElementById('chat-messages');
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // --- UTILITY FUNCTIONS ---
        function showToast(type, message) {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `p-4 mb-3 rounded-lg shadow-xl text-white transform transition-all duration-300 translate-x-full opacity-0`;
            
            let bgColor = '';
            if (type === 'success') {
                bgColor = 'bg-green-500';
            } else if (type === 'error') {
                bgColor = 'bg-red-500';
            } else if (type === 'info') {
                bgColor = 'bg-blue-500';
            } else if (type === 'notification') {
                bgColor = 'bg-yellow-400';
            }
            
            toast.classList.add(bgColor);
            toast.innerHTML = `
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <i class="fa-solid ${type === 'success' ? 'fa-check-circle' : 'fa-info-circle'} mr-2"></i>
                    </div>
                    <div>
                        <p class="font-bold">${message}</p>
                    </div>
                </div>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('translate-x-full', 'opacity-0');
                toast.classList.add('translate-x-0', 'opacity-100');
            }, 100);
            setTimeout(() => {
                toast.classList.remove('translate-x-0', 'opacity-100');
                toast.classList.add('translate-x-full', 'opacity-0');
                toast.addEventListener('transitionend', () => toast.remove());
            }, 5000);
        }

        function copyAccessCode() {
            const codeEl = document.getElementById('unique-access-code');
            const range = document.createRange();
            range.selectNode(codeEl);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast('success', translations[localStorage.getItem('selectedLanguage') || 'id'].unique_code_copied);
                }
            } catch (err) {
                console.error('Failed to copy text:', err);
                showToast('error', "Gagal menyalin kode. Silakan salin manual: " + codeEl.textContent);
            }
            window.getSelection().removeAllRanges();
        }

        function copyDonationNumber() {
            const numberEl = document.getElementById('donation-number');
            const range = document.createRange();
            range.selectNode(numberEl);
            window.getSelection().removeAllRanges();
            window.getSelection().addRange(range);
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast('success', 'Nomor telepon berhasil disalin!');
                }
            } catch (err) {
                console.error('Failed to copy text:', err);
                showToast('error', "Gagal menyalin nomor. Silakan salin manual: " + numberEl.textContent);
            }
            window.getSelection().removeAllRanges();
        }

        // --- API & DATA HANDLING ---
        async function fetchData() {
            const pondokDbId = sessionStorage.getItem('currentPondokId');
            if (!pondokDbId) return null;
            if (appDataCache[pondokDbId]) {
                return appDataCache[pondokDbId];
            }
            try {
                const response = await fetch('/api/get-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pondokDbId: pondokDbId
                    })
                });
                const result = await response.json();
                if (result.success) {
                    appDataCache[pondokDbId] = result.data;
                    return appDataCache[pondokDbId];
                } else {
                    console.error("Gagal mengambil data dari server:", result.message);
                    return null;
                }
            } catch (error) {
                console.error("Gagal mengirim data ke server:", error);
                return null;
            }
        }

        async function saveData(endpoint, payload) {
            const currentPondokId = sessionStorage.getItem('currentPondokId');
            if (!currentPondokId) {
                showToast('error', "Sesi login berakhir. Silakan login kembali.");
                logout();
                return false;
            }
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                const result = await response.json();
                if (result.success) {
                    appDataCache = {};
                    return true;
                } else {
                    console.error("Gagal menyimpan data:", result.message);
                    showToast('error', "Gagal menyimpan data: " + result.message);
                    return false;
                }
            } catch (error) {
                console.error("Gagal mengirim data ke server:", error);
                showToast('error', "Error koneksi ke server.");
                return false;
            }
        }

        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);
            try {
                const response = await fetch('/unggah', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                if (result.success) {
                    return result.file_url;
                } else {
                    showToast('error', 'Gagal mengunggah foto: ' + result.message);
                    return null;
                }
            } catch (error) {
                showToast('error', 'Error koneksi saat mengunggah foto.');
                return null;
            }
        }
        
        // Notification API
        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                console.log("Browser ini tidak mendukung notifikasi desktop");
            } else if (Notification.permission === "granted") {
                console.log("Izin notifikasi sudah diberikan.");
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(function (permission) {
                    if (permission === "granted") {
                        showToast('info', "Notifikasi diaktifkan!");
                    }
                });
            }
        }

        function sendNotification(title, body) {
            if (Notification.permission === "granted") {
                const options = {
                    body: body,
                    icon: 'https://placehold.co/64x64/2a9d8f/ffffff?text=SQ'
                };
                const notification = new Notification(title, options);
                notification.onclick = function(event) {
                    event.preventDefault();
                    window.focus();
                }
            } else {
                console.log("Izin notifikasi tidak diberikan.");
            }
        }

        function sendNotificationToGuardian(santriName, setoran, penilaian) {
            sendNotification("Update Hafalan Santri", `${santriName} telah selesai menyetorkan hafalannya. Setoran: ${setoran}. Penilaian: ${penilaian}.`);
        }
        
        function sendNewPostNotification(author, mediaType) {
            sendNotification("Postingan Baru", `Postingan baru dari ${author} telah ditambahkan. Yuk, cek sekarang!`);
        }

        // --- AUTHENTICATION FLOW ---
        function handleRoleSelection(role) {
            loginContext = role;
            if (role === 'wali') {
                showPage('accessCode');
            } else if (role === 'guru') {
                showPage('pondokLogin');
            }
        }

        document.getElementById('pondok-register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const pondokId = document.getElementById('register-pondok-id').value.trim();
            const password = document.getElementById('register-password').value;
            const errorEl = document.getElementById('register-error');
            if (!pondokId.includes('#') || password.length < 6) {
                errorEl.textContent = "Format Nama Pondok salah atau kata sandi terlalu pendek.";
                errorEl.classList.remove('hidden');
                return;
            }
            const pondokName = pondokId.split('#')[0].trim();
            try {
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pondokId,
                        password,
                        pondokName
                    })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('success', `Pendaftaran berhasil! Kode Akses Unik Anda: ${result.accessCode}. Salin kode ini dan berikan kepada wali santri.`);
                    showPage('pondokLogin');
                } else {
                    errorEl.textContent = result.message;
                    errorEl.classList.remove('hidden');
                }
            } catch (error) {
                errorEl.textContent = "Terjadi kesalahan saat mendaftar.";
                errorEl.classList.remove('hidden');
            }
        });
        document.getElementById('pondok-login-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const pondokId = document.getElementById('login-pondok-id').value.trim();
            const password = document.getElementById('login-password').value;
            const errorEl = document.getElementById('pondok-login-error');
            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        pondokId,
                        password
                    })
                });
                const result = await response.json();
                if (result.success) {
                    sessionStorage.setItem('currentPondokId', result.pondokDbId);
                    sessionStorage.setItem('pondokName', result.pondokName);
                    sessionStorage.setItem('role', 'guru');
                    checkLoginState();
                } else {
                    errorEl.textContent = result.message;
                    errorEl.classList.remove('hidden');
                }
            } catch (error) {
                errorEl.textContent = "Terjadi kesalahan saat login.";
                errorEl.classList.remove('hidden');
            }
        });
        document.getElementById('access-code-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const accessCode = document.getElementById('access-code').value.trim();
            const errorEl = document.getElementById('access-code-error');
            errorEl.classList.add('hidden');
            try {
                const response = await fetch('/api/wali-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        accessCode
                    })
                });
                const result = await response.json();
                if (result.success) {
                    sessionStorage.setItem('currentPondokId', result.pondokDbId);
                    sessionStorage.setItem('pondokName', result.pondokName);
                    sessionStorage.setItem('role', 'wali');
                    checkLoginState();
                } else {
                    errorEl.textContent = result.message;
                    errorEl.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Error:", error);
                errorEl.textContent = "Terjadi kesalahan koneksi. Silakan coba lagi.";
                errorEl.classList.remove('hidden');
            }
        });
        function logout() {
            sessionStorage.clear();
            loginContext = null;
            const accessCodeInput = document.getElementById('access-code');
            if (accessCodeInput) {
                accessCodeInput.value = '';
            }
            const pondokLoginForm = document.getElementById('pondok-login-form');
            if (pondokLoginForm) {
                pondokLoginForm.reset();
            }
            showPage('roleSelection');
        }

        // --- DASHBOARD RENDERING ---
        async function renderWaliDashboard() {
            const pondokData = await fetchData();
            if (!pondokData || !pondokData.santri) return;
            const kelasListContainer = document.getElementById('kelas-list-container');
            const santriListContainer = document.getElementById('santri-list-container');
            if (kelasListContainer) kelasListContainer.classList.remove('hidden');
            if (santriListContainer) santriListContainer.classList.add('hidden');
            const kelasGrid = document.getElementById('kelas-grid');
            kelasGrid.innerHTML = '';
            
            const uniqueKelas = [...new Set(pondokData.santri.map(s => s.kelas))].sort();
            uniqueKelas.forEach(kelas => {
                const card = document.createElement('div');
                card.className = 'text-center cursor-pointer p-6 bg-gray-800 rounded-lg shadow-md hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1';
                card.innerHTML = `
                    <div class="flex items-center justify-center mb-4 text-4xl text-yellow-400">
                        <i class="fas fa-mosque"></i>
                    </div>
                    <h3 class="text-xl font-bold text-yellow-400">Kelas ${kelas}</h3>
                    <p class="text-sm text-gray-400 mt-2">Lihat daftar santri</p>
                `;
                card.onclick = () => showSantriListByKelas(kelas);
                kelasGrid.appendChild(card);
            });
        }

        function showSantriListByKelas(kelas) {
            const pondokData = appDataCache[sessionStorage.getItem('currentPondokId')];
            if (!pondokData) return;

            const filteredSantri = pondokData.santri.filter(s => s.kelas === kelas).sort((a, b) => a.nama.localeCompare(b.nama));

            const kelasListContainer = document.getElementById('kelas-list-container');
            const santriListContainer = document.getElementById('santri-list-container');
            const currentClassTitle = document.getElementById('current-class-title');
            const santriGallery = document.getElementById('santri-gallery');

            if (kelasListContainer) kelasListContainer.classList.add('hidden');
            if (santriListContainer) santriListContainer.classList.remove('hidden');
            if (currentClassTitle) currentClassTitle.textContent = `Daftar Santri Kelas ${kelas}`;
            
            sessionStorage.setItem('currentWaliKelas', kelas);

            santriGallery.innerHTML = '';
            if (filteredSantri.length === 0) {
                santriGallery.innerHTML = '<p class="text-center text-gray-500 py-10">Tidak ada santri di kelas ini.</p>';
            } else {
                filteredSantri.forEach(santri => {
                    const fotoUrl = santri.foto || 'https://placehold.co/400x400?text=No+Photo';
                    const card = document.createElement('div');
                    card.className = 'text-center cursor-pointer group santri-card';
                    card.dataset.name = santri.nama;
                    card.innerHTML = `
                    <div class="relative">
                        <img src="${fotoUrl}" alt="Foto ${santri.nama}" class="w-full h-auto aspect-square rounded-full object-cover transition-transform duration-300 group-hover:scale-105 border-4 border-yellow-400 shadow-lg" onerror="this.onerror=null;this.src='https://placehold.co/400x400?text=Error';">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 rounded-full transition-all duration-300 flex items-center justify-center">
                            <span class="text-white opacity-0 group-hover:opacity-100 font-bold">Lihat Detail</span>
                        </div>
                    </div>
                    <p class="mt-4 font-semibold text-gray-200">${santri.nama}</p>
                    <p class="text-sm text-gray-400">Kelas ${santri.kelas}</p>
                    `;
                    card.onclick = () => showSantriDetail(santri.id);
                    santriGallery.appendChild(card);
                });
            }
        }

        async function showSantriDetail(santriId) {
            const pondokData = await fetchData();
            if (!pondokData || !pondokData.santri) return;
        
            const santri = pondokData.santri.find(s => s.id === santriId);
            if (!santri) {
                console.error("Santri tidak ditemukan di data.");
                return;
            }
            
            sessionStorage.setItem('currentWaliKelas', santri.kelas);
            const guru = pondokData.guru.find(g => g.mengajar_kelas === santri.kelas);
            const hafalan = pondokData.hafalan.filter(h => h.santri_id === santriId).sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            const detailFoto = document.getElementById('detail-foto');
            if (detailFoto) {
                detailFoto.src = santri.foto || 'https://placehold.co/400x400?text=No+Photo';
                detailFoto.onerror = () => {
                    detailFoto.src = 'https://placehold.co/400x400?text=Error';
                };
            }
            const detailNama = document.getElementById('detail-nama');
            if (detailNama) detailNama.textContent = santri.nama;
            const detailKelas = document.getElementById('detail-kelas');
            if (detailKelas) detailKelas.textContent = `Kelas ${santri.kelas}`;
            const detailPengajar = document.getElementById('detail-pengajar');
            if (detailPengajar) detailPengajar.textContent = guru ? `Pengajar: ${guru.nama}` : 'Pengajar belum diatur';
            const statusEl = document.getElementById('detail-status-target');
            if (statusEl) {
                if (santri.tercapai) {
                    statusEl.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-green-100 text-green-800';
                    statusEl.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>Mencapai Target`;
                } else {
                    statusEl.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-semibold bg-yellow-100 text-yellow-800';
                    statusEl.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>Belum Mencapai Target`;
                }
            }

            const target = santri.target || {};
            const totalHafalanJuzEl = document.getElementById('total-hafalan-juz');
            if (totalHafalanJuzEl) totalHafalanJuzEl.textContent = santri.total_hafalan_juz || '-';
            const targetHarianEl = document.getElementById('target-harian');
            if (targetHarianEl) targetHarianEl.textContent = target.harian || '-';
            const targetMingguanEl = document.getElementById('target-mingguan');
            if (targetMingguanEl) targetMingguanEl.textContent = target.mingguan || '-';
            const targetBulananEl = document.getElementById('target-bulanan');
            if (targetBulananEl) targetBulananEl.textContent = target.bulanan || '-';
            const targetTahunanEl = document.getElementById('target-tahunan');
            if (targetTahunanEl) targetTahunanEl.textContent = target.tahunan || '-';
            const chartsContainer = document.getElementById('progress-charts');
            if (chartsContainer) chartsContainer.innerHTML = '';
            
            if (hafalan.length > 0) {
                const data = {
                    daily: {},
                    weekly: {},
                    monthly: {},
                    yearly: {}
                };
                Date.prototype.getDayOfYear = function() {
                    var start = new Date(this.getFullYear(), 0, 0);
                    var diff = this - start;
                    var oneDay = 1000 * 60 * 60 * 24;
                    return Math.floor(diff / oneDay);
                };

                hafalan.forEach(item => {
                    const date = new Date(item.tanggal);
                    const day = date.toISOString().split('T')[0];
                    const week = `${date.getFullYear()}-${Math.ceil((date.getDayOfYear() + 1) / 7)}`;
                    const month = `${date.getFullYear()}-${date.getMonth() + 1}`;
                    const year = date.getFullYear();

                    data.daily[day] = (data.daily[day] || 0) + 1;
                    data.weekly[week] = (data.weekly[week] || 0) + 1;
                    data.monthly[month] = (data.monthly[month] || 0) + 1;
                    data.yearly[year] = (data.yearly[year] || 0) + 1;
                });

                function createChart(id, title, chartData) {
                    const filteredData = Object.values(chartData).filter(d => !isNaN(d));
                    if (filteredData.length === 0) {
                        return; 
                    }

                    const chartDiv = document.createElement('div');
                    chartDiv.className = "w-full bg-gray-700 rounded-lg p-4 shadow-sm";
                    chartDiv.innerHTML = `<h4 class="text-center font-semibold text-gray-200 mb-2">${title}</h4><svg id="${id}" class="w-full h-48"></svg>`;
                    chartsContainer.appendChild(chartDiv);
                    const svg = d3.select(`#${id}`);
                    const margin = {top: 10, right: 20, bottom: 30, left: 40};
                    const width = parseInt(svg.style("width")) - margin.left - margin.right;
                    const height = parseInt(svg.style("height")) - margin.top - margin.bottom;
                    const x = d3.scaleBand().range([0, width]).padding(0.1);
                    const y = d3.scaleLinear().range([height, 0]);

                    const g = svg.append("g").attr("transform", `translate(${margin.left},${margin.top})`);
                    
                    const keys = Object.keys(chartData);
                    x.domain(keys);
                    y.domain([0, d3.max(filteredData) || 1]); 

                    g.append("g")
                        .attr("transform", `translate(0,${height})`)
                        .call(d3.axisBottom(x))
                        .selectAll("text")
                        .attr("transform", "rotate(-45)")
                        .style("text-anchor", "end");
                    g.append("g").call(d3.axisLeft(y));

                    g.selectAll(".bar")
                        .data(keys)
                        .enter().append("rect")
                        .attr("class", "bar fill-yellow-400")
                        .attr("x", d => x(d))
                        .attr("y", d => y(chartData[d]))
                        .attr("width", x.bandwidth())
                        .attr("height", d => height - y(chartData[d]));
                }
                
                createChart('chart-daily', 'Progres Harian', data.daily);
                createChart('chart-weekly', 'Progres Mingguan', data.weekly);
                createChart('chart-monthly', 'Progres Bulanan', data.monthly);
                createChart('chart-yearly', 'Progres Tahunan', data.yearly);
            } else {
                chartsContainer.innerHTML = '<p class="text-center text-gray-500 py-10">Belum ada data hafalan untuk menampilkan grafik.</p>';
            }
        
            const historyBody = document.getElementById('hafalan-history');
            if (historyBody) {
                historyBody.innerHTML = '';
                if (hafalan.length > 0) {
                    hafalan.forEach(h => {
                        const row = historyBody.insertRow();
                        row.innerHTML = `<td class="py-4 px-6 text-sm text-gray-200">${new Date(h.tanggal).toLocaleDateString('id-ID', { year: 'numeric', month: 'long', day: 'numeric' })}</td><td class="py-4 px-6 text-sm text-gray-200 font-medium">${h.setoran}</td><td class="py-4 px-6 text-sm text-gray-400">${h.jenis}</td><td class="py-4 px-6 text-sm"><span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${h.penilaian === 'Lancar' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${h.penilaian}</span></td>`;
                    });
                } else {
                    historyBody.innerHTML = '<tr><td colspan="4" class="text-center py-8 text-gray-400">Belum ada riwayat setoran.</td></tr>';
                }
            }
            showPage('detailSantri');
        }
    </script>
</body>
</html>
